<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.2 Different numbers of state processes | MARSS Package Manual</title>
  <meta name="description" content="This is the manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MARSS Modeling for Environmenal Data." />
  <meta name="generator" content="bookdown 0.15 and GitBook 2.6.7" />

  <meta property="og:title" content="4.2 Different numbers of state processes | MARSS Package Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="This is the manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MARSS Modeling for Environmenal Data." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.2 Different numbers of state processes | MARSS Package Manual" />
  
  <meta name="twitter:description" content="This is the manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MARSS Modeling for Environmenal Data." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="E. E. Holmes" />


<meta name="date" content="2019-11-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="fixed-and-estimated-elements-in-parameter-matrices.html"/>
<link rel="next" href="time-varying-parameters.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MARSS Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#author"><i class="fa fa-check"></i>Author</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface-1.html"><a href="preface-1.html"><i class="fa fa-check"></i>Preface</a></li>
<li><a href="part1.html#part1"><i style="font-size: 110%; color:#990017;">Part 1. Overview</i></a></li>
<li class="chapter" data-level="1" data-path="chap-overview.html"><a href="chap-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="examples-of-marss-models.html"><a href="examples-of-marss-models.html"><i class="fa fa-check"></i><b>1.1</b> Examples of MARSS models</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="how-to-get-started-quickly.html"><a href="how-to-get-started-quickly.html"><i class="fa fa-check"></i><b>2</b> How to get started (quickly)</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-your-data-in-right-format.html"><a href="getting-your-data-in-right-format.html"><i class="fa fa-check"></i><b>2.1</b> Getting your data in right format</a><ul>
<li class="chapter" data-level="2.1.1" data-path="getting-your-data-in-right-format.html"><a href="getting-your-data-in-right-format.html#univariate-example"><i class="fa fa-check"></i><b>2.1.1</b> Univariate example</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-your-data-in-right-format.html"><a href="getting-your-data-in-right-format.html#multivariate-example"><i class="fa fa-check"></i><b>2.1.2</b> Multivariate example</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="important-notes-about-the-algorithms.html"><a href="important-notes-about-the-algorithms.html"><i class="fa fa-check"></i><b>2.2</b> Important notes about the algorithms</a></li>
<li class="chapter" data-level="2.3" data-path="state-space-form-of-armapq-models.html"><a href="state-space-form-of-armapq-models.html"><i class="fa fa-check"></i><b>2.3</b> State-space form of ARMA(p,q) models</a></li>
<li class="chapter" data-level="2.4" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>2.4</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="getting-your-data-in-right-format-1.html"><a href="getting-your-data-in-right-format-1.html"><i class="fa fa-check"></i><b>3</b> Getting your data in right format</a><ul>
<li class="chapter" data-level="3.1" data-path="univariate-example-1.html"><a href="univariate-example-1.html"><i class="fa fa-check"></i><b>3.1</b> Univariate example</a></li>
<li class="chapter" data-level="3.2" data-path="multivariate-example-1.html"><a href="multivariate-example-1.html"><i class="fa fa-check"></i><b>3.2</b> Multivariate example</a></li>
<li class="chapter" data-level="3.3" data-path="important-notes-about-the-algorithms-1.html"><a href="important-notes-about-the-algorithms-1.html"><i class="fa fa-check"></i><b>3.3</b> Important notes about the algorithms</a></li>
<li class="chapter" data-level="3.4" data-path="state-space-form-of-armapq-models-1.html"><a href="state-space-form-of-armapq-models-1.html"><i class="fa fa-check"></i><b>3.4</b> State-space form of ARMA(p,q) models</a></li>
<li class="chapter" data-level="3.5" data-path="troubleshooting-1.html"><a href="troubleshooting-1.html"><i class="fa fa-check"></i><b>3.5</b> Troubleshooting</a></li>
</ul></li>
<li><a href="part2.html#part2"><i style="font-size: 110%; color:#990017;">Part 2. Examples</i></a></li>
<li class="chapter" data-level="4" data-path="short-examples.html"><a href="short-examples.html"><i class="fa fa-check"></i><b>4</b> Short Examples</a><ul>
<li class="chapter" data-level="4.1" data-path="fixed-and-estimated-elements-in-parameter-matrices.html"><a href="fixed-and-estimated-elements-in-parameter-matrices.html"><i class="fa fa-check"></i><b>4.1</b> Fixed and estimated elements in parameter matrices</a></li>
<li class="chapter" data-level="4.2" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html"><i class="fa fa-check"></i><b>4.2</b> Different numbers of state processes</a><ul>
<li class="chapter" data-level="4.2.1" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#one-hidden-state-process-for-each-observation-time-series"><i class="fa fa-check"></i><b>4.2.1</b> One hidden state process for each observation time series</a></li>
<li class="chapter" data-level="4.2.2" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#five-correlated-hidden-state-processes"><i class="fa fa-check"></i><b>4.2.2</b> Five correlated hidden state processes</a></li>
<li class="chapter" data-level="4.2.3" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#five-equally-correlated-hidden-state-processes"><i class="fa fa-check"></i><b>4.2.3</b> Five equally correlated hidden state processes</a></li>
<li class="chapter" data-level="4.2.4" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#five-hidden-state-processes-with-a-north-and-asouth-mathbfu-and-mathbfq-elements"><i class="fa fa-check"></i><b>4.2.4</b> Five hidden state processes with a <code>north'' and a</code>south’’ <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{Q}\)</span> elements</a></li>
<li class="chapter" data-level="4.2.5" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#fixed-observation-error-variance"><i class="fa fa-check"></i><b>4.2.5</b> Fixed observation error variance</a></li>
<li class="chapter" data-level="4.2.6" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#one-hidden-state-and-five-i.i.d.-observation-time-series"><i class="fa fa-check"></i><b>4.2.6</b> One hidden state and five i.i.d. observation time series</a></li>
<li class="chapter" data-level="4.2.7" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#one-hidden-state-and-five-independent-observation-time-series-with-different-variances"><i class="fa fa-check"></i><b>4.2.7</b> One hidden state and five independent observation time series with different variances</a></li>
<li class="chapter" data-level="4.2.8" data-path="different-numbers-of-state-processes.html"><a href="different-numbers-of-state-processes.html#two-hidden-state-processes"><i class="fa fa-check"></i><b>4.2.8</b> Two hidden state processes</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="time-varying-parameters.html"><a href="time-varying-parameters.html"><i class="fa fa-check"></i><b>4.3</b> Time-varying parameters</a></li>
<li class="chapter" data-level="4.4" data-path="including-inputs-or-covariates.html"><a href="including-inputs-or-covariates.html"><i class="fa fa-check"></i><b>4.4</b> Including inputs (or covariates)</a></li>
<li class="chapter" data-level="4.5" data-path="printing-and-summarizing-models-and-model-fits.html"><a href="printing-and-summarizing-models-and-model-fits.html"><i class="fa fa-check"></i><b>4.5</b> Printing and summarizing models and model fits</a></li>
<li class="chapter" data-level="4.6" data-path="tidy-output.html"><a href="tidy-output.html"><i class="fa fa-check"></i><b>4.6</b> Tidy output</a></li>
<li class="chapter" data-level="4.7" data-path="confidence-intervals-on-a-fitted-model.html"><a href="confidence-intervals-on-a-fitted-model.html"><i class="fa fa-check"></i><b>4.7</b> Confidence intervals on a fitted model</a><ul>
<li class="chapter" data-level="4.7.1" data-path="confidence-intervals-on-a-fitted-model.html"><a href="confidence-intervals-on-a-fitted-model.html#approximate-confidence-intervals-from-a-hessian-matrix"><i class="fa fa-check"></i><b>4.7.1</b> Approximate confidence intervals from a Hessian matrix</a></li>
<li class="chapter" data-level="4.7.2" data-path="confidence-intervals-on-a-fitted-model.html"><a href="confidence-intervals-on-a-fitted-model.html#confidence-intervals-from-a-parametric-bootstrap"><i class="fa fa-check"></i><b>4.7.2</b> Confidence intervals from a parametric bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="vectors-of-just-the-estimated-parameters.html"><a href="vectors-of-just-the-estimated-parameters.html"><i class="fa fa-check"></i><b>4.8</b> Vectors of just the estimated parameters</a></li>
<li class="chapter" data-level="4.9" data-path="kalman-filter-and-smoother-output.html"><a href="kalman-filter-and-smoother-output.html"><i class="fa fa-check"></i><b>4.9</b> Kalman filter and smoother output</a></li>
<li class="chapter" data-level="4.10" data-path="degenerate-variance-estimates.html"><a href="degenerate-variance-estimates.html"><i class="fa fa-check"></i><b>4.10</b> Degenerate variance estimates</a></li>
<li class="chapter" data-level="4.11" data-path="bootstrap-parameter-estimates.html"><a href="bootstrap-parameter-estimates.html"><i class="fa fa-check"></i><b>4.11</b> Bootstrap parameter estimates</a></li>
<li class="chapter" data-level="4.12" data-path="data-simulation.html"><a href="data-simulation.html"><i class="fa fa-check"></i><b>4.12</b> Data simulation</a><ul>
<li class="chapter" data-level="4.12.1" data-path="data-simulation.html"><a href="data-simulation.html#simulated-data-from-a-fitted-marss-model"><i class="fa fa-check"></i><b>4.12.1</b> Simulated data from a fitted MARSS model</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="bootstrap-aic.html"><a href="bootstrap-aic.html"><i class="fa fa-check"></i><b>4.13</b> Bootstrap AIC</a></li>
<li class="chapter" data-level="4.14" data-path="convergence.html"><a href="convergence.html"><i class="fa fa-check"></i><b>4.14</b> Convergence</a></li>
</ul></li>
<li><a href="part3.html#part3"><i style="font-size: 110%; color:#990017;">Part 3. Outputs</i></a></li>
<li class="chapter" data-level="5" data-path="marss-outputs.html"><a href="marss-outputs.html"><i class="fa fa-check"></i><b>5</b> MARSS outputs</a></li>
<li class="chapter" data-level="6" data-path="marss-residuals.html"><a href="marss-residuals.html"><i class="fa fa-check"></i><b>6</b> MARSS Residuals</a></li>
<li class="chapter" data-level="7" data-path="confidence-intervals.html"><a href="confidence-intervals.html"><i class="fa fa-check"></i><b>7</b> Confidence Intervals</a></li>
<li class="chapter" data-level="8" data-path="predictions.html"><a href="predictions.html"><i class="fa fa-check"></i><b>8</b> Predictions</a></li>
<li><a href="part4.html#part4"><i style="font-size: 110%; color:#990017;">Part 4. Tips and Tricks</i></a></li>
<li class="chapter" data-level="9" data-path="troubleshooting-2.html"><a href="troubleshooting-2.html"><i class="fa fa-check"></i><b>9</b> Troubleshooting</a></li>
<li class="chapter" data-level="10" data-path="em-algorithm.html"><a href="em-algorithm.html"><i class="fa fa-check"></i><b>10</b> EM algorithm</a><ul>
<li class="chapter" data-level="10.1" data-path="important-notes-about-the-algorithms-2.html"><a href="important-notes-about-the-algorithms-2.html"><i class="fa fa-check"></i><b>10.1</b> Important notes about the algorithms</a></li>
<li class="chapter" data-level="10.2" data-path="state-space-form-of-armapq-models-2.html"><a href="state-space-form-of-armapq-models-2.html"><i class="fa fa-check"></i><b>10.2</b> State-space form of ARMA(p,q) models</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="other-related-packages.html"><a href="other-related-packages.html"><i class="fa fa-check"></i><b>11</b> Other related packages</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li style="font-weight: normal"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MARSS Package Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="different-numbers-of-state-processes" class="section level2">
<h2><span class="header-section-number">4.2</span> Different numbers of state processes</h2>
<p>Here we show a series of short examples using a dataset on Washington harbor seals (<code>?harborSealWA</code>), which has five observation time series. The dataset is a little unusual in that it has four missing years from years 2 to 5. This causes some interesting issues with prior specification. Before starting the harbor seal examples, we set up the data, making time go across the columns and removing the year column:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">dat =<span class="st"> </span><span class="kw">t</span>(harborSealWA)</a>
<a class="sourceLine" id="cb11-2" title="2">dat =<span class="st"> </span>dat[<span class="dv">2</span><span class="op">:</span><span class="kw">nrow</span>(dat),] <span class="co">#remove the year row</span></a></code></pre></div>
<div id="one-hidden-state-process-for-each-observation-time-series" class="section level3">
<h3><span class="header-section-number">4.2.1</span> One hidden state process for each observation time series</h3>
<p>This is the default model for the <code>MARSS()</code> function. In this case, <span class="math inline">\(n=m\)</span>, the observation errors are i.i.d. and the process errors are independent and have different variances. The elements in <span class="math inline">\(\mathbf{u}\)</span> are all different (meaning, they are not forced to be the same). Mathematically, the MARSS model being fit is:
<span class="math display">\[\begin{gather*}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
= \begin{bmatrix}1&amp;0&amp;0&amp;0&amp;0\\0&amp;1&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;0&amp;1\end{bmatrix}
\begin{bmatrix}x_{1,t-1}\\x_{2,t-1}\\x_{3,t-1}\\x_{4,t-1}\\x_{5,t-1}\end{bmatrix}
+ \begin{bmatrix}u_1\\u_2\\u_3\\u_4\\u_5\end{bmatrix}
+ \begin{bmatrix}w_{1,t}\\w_{2,t}\\w_{3,t}\\w_{4,t}\\w_{5,t}\end{bmatrix},
 \textrm{ } \mathbf{w}_t \sim \,\text{MVN}\begin{pmatrix}\begin{bmatrix}0\\0\\0\\0\\0\end{bmatrix},\begin{bmatrix}q_1&amp;0&amp;0&amp;0&amp;0\\0&amp;q_2&amp;0&amp;0&amp;0\\0&amp;0&amp;q_3&amp;0&amp;0\\0&amp;0&amp;0&amp;q_4&amp;0\\0&amp;0&amp;0&amp;0&amp;q_5\end{bmatrix} \end{pmatrix}  \\
\\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1&amp;0&amp;0&amp;0&amp;0\\0&amp;1&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;0&amp;1\end{bmatrix}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
+ \begin{bmatrix}0\\0\\0\\0\\0\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix},
 \textrm{ } \mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix}\begin{bmatrix}0\\0\\0\\0\\0\end{bmatrix},\begin{bmatrix}r&amp;0&amp;0&amp;0&amp;0\\0&amp;r&amp;0&amp;0&amp;0\\0&amp;0&amp;r&amp;0&amp;0\\0&amp;0&amp;0&amp;r&amp;0\\0&amp;0&amp;0&amp;0&amp;r\end{bmatrix} \end{pmatrix}  \\
\end{gather*}\]</span>
This is the default model, so you can fit it by simply passing <code>dat</code> to <code>MARSS()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat)</a></code></pre></div>
<pre><code>Success! abstol and log-log tests passed at 38 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 38 iterations. 
Log-likelihood: 19.13428 
AIC: -6.268557   AICc: 3.805517   
 
                    Estimate
R.diag               0.00895
U.X.SJF              0.06839
U.X.SJI              0.07163
U.X.EBays            0.04179
U.X.PSnd             0.05226
U.X.HC              -0.00279
Q.(X.SJF,X.SJF)      0.03205
Q.(X.SJI,X.SJI)      0.01098
Q.(X.EBays,X.EBays)  0.00706
Q.(X.PSnd,X.PSnd)    0.00414
Q.(X.HC,X.HC)        0.05450
x0.X.SJF             5.98647
x0.X.SJI             6.72487
x0.X.EBays           6.66212
x0.X.PSnd            5.83969
x0.X.HC              6.60482
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
<p>The output warns you that the convergence tolerance is high. You can set it lower by passing in <code>control=list(conv.test.slope.tol=0.1)</code>. <code>MARSS()</code> is automatically creating parameter names since you did not tell it the names. To see exactly where each parameter element appears in its parameter matrix, type <code>summary(kemfit$model)</code>.</p>
<p>Though it is not necessary to specify the model for this example since it is the default, here is how you could do so using matrices:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">B=Z=<span class="kw">diag</span>(<span class="dv">1</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb14-2" title="2">U=<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="st">&quot;u1&quot;</span>,<span class="st">&quot;u2&quot;</span>,<span class="st">&quot;u3&quot;</span>,<span class="st">&quot;u4&quot;</span>,<span class="st">&quot;u5&quot;</span>),<span class="dv">5</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-3" title="3">x0=A=<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-4" title="4">R=Q=<span class="kw">matrix</span>(<span class="kw">list</span>(<span class="dv">0</span>),<span class="dv">5</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw">diag</span>(R)=<span class="st">&quot;r&quot;</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="kw">diag</span>(Q)=<span class="kw">c</span>(<span class="st">&quot;q1&quot;</span>,<span class="st">&quot;q2&quot;</span>,<span class="st">&quot;q3&quot;</span>,<span class="st">&quot;q4&quot;</span>,<span class="st">&quot;q5&quot;</span>)</a></code></pre></div>
<p>Notice that when a matrix has both fixed and estimated elements (like <span class="math inline">\(\mathbf{R}\)</span> and <span class="math inline">\(\mathbf{Q}\)</span>), a list matrix is used to allow you to specify the fixed elements as numeric and to give the estimated elements character names.</p>
<p>The default MLE method is the EM algorithm (<code>method="kem"</code>). You can also use a quasi-Newton method (BFGS)
by setting <code>method="BFGS"</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">kemfit.bfgs =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">method=</span><span class="st">&quot;BFGS&quot;</span>)</a></code></pre></div>
<pre><code>Success! Converged in 99 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 99 iterations. 
Log-likelihood: 19.13936 
AIC: -6.278712   AICc: 3.795362   
 
                    Estimate
R.diag               0.00849
U.X.SJF              0.06838
U.X.SJI              0.07152
U.X.EBays            0.04188
U.X.PSnd             0.05233
U.X.HC              -0.00271
Q.(X.SJF,X.SJF)      0.03368
Q.(X.SJI,X.SJI)      0.01124
Q.(X.EBays,X.EBays)  0.00722
Q.(X.PSnd,X.PSnd)    0.00437
Q.(X.HC,X.HC)        0.05600
x0.X.SJF             5.98437
x0.X.SJI             6.72169
x0.X.EBays           6.65689
x0.X.PSnd            5.83527
x0.X.HC              6.60425
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
<p>Using the default EM convergence criteria, the EM algorithm stops at a log-likelihood a little lower than the BFGS algorithm does, but the EM algorithm was faster, 6 times faster, in this case.
If you wanted to use the EM fit as the initial conditions, pass in the <code>inits</code> argument using the <code>$par</code> element (or <code>coef(fit,form="marss")</code>) of the EM fit.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">kemfit.bfgs2 =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">method=</span><span class="st">&quot;BFGS&quot;</span>, <span class="dt">inits=</span>kemfit<span class="op">$</span>par)</a></code></pre></div>
<p>The BFGS algorithm now converges in 103 iterations. Output not shown.</p>
<p>We mentioned that the missing years from year 2 to 4 creates an interesting issue with the prior specification. The default behavior of MARSS is to treat the initial state as at <span class="math inline">\(t=0\)</span> instead of <span class="math inline">\(t=1\)</span>. Usually this doesn’t make a difference, but for this dataset, if we set the prior at <span class="math inline">\(t=1\)</span>, the MLE estimate of <span class="math inline">\(\mathbf{R}\)</span> becomes 0. If we estimate <span class="math inline">\(\mathbf{x}_1\)</span> as a parameter and let <span class="math inline">\(\mathbf{R}\)</span> go to 0, the likelihood will go to infinity (slowly but surely). This is neither an error nor a pathology, but is probably not what you would like to have happen. Note that the ``BFGS’’ algorithm will not find the maximum in this case; it will stop before <span class="math inline">\(\mathbf{R}\)</span> gets small and the likelihood gets very large. However, the EM algorithm will climb up the peak. You can try it by running the following code. It will report warnings which you can read about in Appendix <a href="#app:warnings"><strong>??</strong></a>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">kemfit.strange =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">tinitx=</span><span class="dv">1</span>))</a></code></pre></div>
</div>
<div id="five-correlated-hidden-state-processes" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Five correlated hidden state processes</h3>
<p>This is the same model except that the five hidden states have correlated process errors. Mathematically, this is the model:
<span class="math display">\[\begin{gather*}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
= \begin{bmatrix}x_{1,t-1}\\x_{2,t-1}\\x_{3,t-1}\\x_{4,t-1}\\x_{5,t-1}\end{bmatrix}
+ \begin{bmatrix}u_1\\u_2\\u_3\\u_4\\u_5\end{bmatrix}
+ \begin{bmatrix}w_{1,t}\\w_{2,t}\\w_{3,t}\\w_{4,t}\\w_{5,t}\end{bmatrix}, 
 \textrm{ } \mathbf{w}_t \sim \,\text{MVN}\begin{pmatrix}0,
 \begin{bmatrix}q_1&amp;c_{1,2}&amp;c_{1,3}&amp;c_{1,4}&amp;c_{1,5}\\c_{1,2}&amp;q_2&amp;c_{2,3}&amp;c_{2,4}&amp;c_{2,5}\\
 c_{1,3}&amp;c_{2,3}&amp;q_3&amp;c_{3,4}&amp;c_{3,5}\\c_{1,4}&amp;c_{2,4}&amp;c_{3,4}&amp;q_4&amp;c_{4,5}\\
 c_{1,5}&amp;c_{2,5}&amp;c_{3,5}&amp;c_{4,5}&amp;q_5\end{bmatrix} \end{pmatrix} \\
\\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1&amp;0&amp;0&amp;0&amp;0\\0&amp;1&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;0&amp;1\end{bmatrix}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
+ \begin{bmatrix}0\\0\\0\\0\\0\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix}, 
 \textrm{ } \mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix} 0,\begin{bmatrix}r&amp;0&amp;0&amp;0&amp;0\\0&amp;r&amp;0&amp;0&amp;0\\0&amp;0&amp;r&amp;0&amp;0\\0&amp;0&amp;0&amp;r&amp;0\\0&amp;0&amp;0&amp;0&amp;r\end{bmatrix} \end{pmatrix}  \\
\end{gather*}\]</span>
<span class="math inline">\(\mathbf{B}\)</span> is not shown in the top equation; it is a <span class="math inline">\(m \times m\)</span> identity matrix. To fit, use <code>MARSS()</code> with the <code>model</code> argument set (output not shown).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">Q=</span><span class="st">&quot;unconstrained&quot;</span>))</a></code></pre></div>
<p>This shows one of the text shortcuts, <code>"unconstrained"</code>, which means estimate all elements in the matrix. This shortcut can be used for all parameter matrices.</p>
</div>
<div id="five-equally-correlated-hidden-state-processes" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Five equally correlated hidden state processes</h3>
<p>This is the same model except that now there is only one process error variance and one process error covariance. Mathematically, the model is:
<span class="math display">\[\begin{gather*}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
= \begin{bmatrix}x_{1,t-1}\\x_{2,t-1}\\x_{3,t-1}\\x_{4,t-1}\\x_{5,t-1}\end{bmatrix}
+ \begin{bmatrix}u_1\\u_2\\u_3\\u_4\\u_5\end{bmatrix}
+ \begin{bmatrix}w_{1,t}\\w_{2,t}\\w_{3,t}\\w_{4,t}\\w_{5,t}\end{bmatrix},
 \textrm{ } \mathbf{w}_t \sim \,\text{MVN}\begin{pmatrix} 0,
 \begin{bmatrix}q&amp;c&amp;c&amp;c&amp;c\\c&amp;q&amp;c&amp;c&amp;c\\c&amp;c&amp;q&amp;c&amp;c\\c&amp;c&amp;c&amp;q&amp;c\\c&amp;c&amp;c&amp;c&amp;q\end{bmatrix} \end{pmatrix} \\
\\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1&amp;0&amp;0&amp;0&amp;0\\0&amp;1&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;0&amp;1\end{bmatrix}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
+ \begin{bmatrix}0\\0\\0\\0\\0\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix},
 \textrm{  } \mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix} 0,\begin{bmatrix}r&amp;0&amp;0&amp;0&amp;0\\0&amp;r&amp;0&amp;0&amp;0\\0&amp;0&amp;r&amp;0&amp;0\\0&amp;0&amp;0&amp;r&amp;0\\0&amp;0&amp;0&amp;0&amp;r\end{bmatrix} \end{pmatrix}  \\
\end{gather*}\]</span>
Again <span class="math inline">\(\mathbf{B}\)</span> is not shown in the top equation; it is a <span class="math inline">\(m \times m\)</span> identity matrix. To fit, use the following code (output not shown):</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">Q=</span><span class="st">&quot;equalvarcov&quot;</span>))</a></code></pre></div>
<p>The shortcut `<code>"equalvarcov"</code> means one value on the diagonal and one on the off-diagonal. It can be used for all square matrices (<span class="math inline">\(\mathbf{B}\)</span>,<span class="math inline">\(\mathbf{Q}\)</span>,<span class="math inline">\(\mathbf{R}\)</span>, and <span class="math inline">\(\boldsymbol{\Lambda}\)</span>).</p>
</div>
<div id="five-hidden-state-processes-with-a-north-and-asouth-mathbfu-and-mathbfq-elements" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Five hidden state processes with a <code>north'' and a</code>south’’ <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{Q}\)</span> elements</h3>
<p>Here we fit a model with five independent hidden states where each observation time series is an independent observation of a different hidden trajectory
but the hidden trajectories 1-3 share their <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{Q}\)</span> elements, while hidden trajectories 4-5 share theirs. This is the model:
<span class="math display">\[\begin{gather*}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
= \begin{bmatrix}x_{1,t-1}\\x_{2,t-1}\\x_{3,t-1}\\x_{4,t-1}\\x_{5,t-1}\end{bmatrix}
+ \begin{bmatrix}u_n\\u_n\\u_n\\u_s\\u_s\end{bmatrix}
+ \begin{bmatrix}w_{1,t}\\w_{2,t}\\w_{3,t}\\w_{4,t}\\w_{5,t}\end{bmatrix},  
 \textrm{ } \mathbf{w}_t \sim \,\text{MVN}\begin{pmatrix} 0,\begin{bmatrix}q_n&amp;0&amp;0&amp;0&amp;0\\0&amp;q_n&amp;0&amp;0&amp;0\\0&amp;0&amp;q_n&amp;0&amp;0\\0&amp;0&amp;0&amp;q_s&amp;0\\0&amp;0&amp;0&amp;0&amp;q_s\end{bmatrix} \end{pmatrix}  \\
\\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1&amp;0&amp;0&amp;0&amp;0\\0&amp;1&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;0&amp;1\end{bmatrix}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
+ \begin{bmatrix}0\\0\\0\\0\\0\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix},
 \textrm{ } \mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix} 0,\begin{bmatrix}r&amp;0&amp;0&amp;0&amp;0\\0&amp;r&amp;0&amp;0&amp;0\\0&amp;0&amp;r&amp;0&amp;0\\0&amp;0&amp;0&amp;r&amp;0\\0&amp;0&amp;0&amp;0&amp;r\end{bmatrix} \end{pmatrix}  \\
\end{gather*}\]</span>
To fit use the following code, we specify the <code>model</code> argument for <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{Q}\)</span> using list matrices. List matrices allow us to combine numeric and character values in a matrix. MARSS will interpret the numeric values as fixed, and the character values as parameters to be estimated. Parameters with the same name are constrained to be identical.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">regions=<span class="kw">list</span>(<span class="st">&quot;N&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;S&quot;</span>,<span class="st">&quot;S&quot;</span>)</a>
<a class="sourceLine" id="cb21-2" title="2">U=<span class="kw">matrix</span>(regions,<span class="dv">5</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb21-3" title="3">Q=<span class="kw">matrix</span>(<span class="kw">list</span>(<span class="dv">0</span>),<span class="dv">5</span>,<span class="dv">5</span>); <span class="kw">diag</span>(Q)=regions</a>
<a class="sourceLine" id="cb21-4" title="4">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">U=</span>U, <span class="dt">Q=</span>Q))</a></code></pre></div>
<p>Only <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\mathbf{Q}\)</span> need to be specified since the other parameters are at their default values.</p>
</div>
<div id="fixed-observation-error-variance" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Fixed observation error variance</h3>
<p>Here we fit the same model but with a known observation error variance. This is the model:
<span class="math display">\[\begin{gather*}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
= \begin{bmatrix}x_{1,t-1}\\x_{2,t-1}\\x_{3,t-1}\\x_{4,t-1}\\x_{5,t-1}\end{bmatrix}
+ \begin{bmatrix}u_n\\u_n\\u_n\\u_s\\u_s\end{bmatrix}
+ \begin{bmatrix}w_{1,t}\\w_{2,t}\\w_{3,t}\\w_{4,t}\\w_{5,t}\end{bmatrix},
 \textrm{ } \mathbf{w}_t \sim \,\text{MVN}\begin{pmatrix} 0,\begin{bmatrix}q_n&amp;0&amp;0&amp;0&amp;0\\0&amp;q_n&amp;0&amp;0&amp;0\\0&amp;0&amp;q_n&amp;0&amp;0\\0&amp;0&amp;0&amp;q_s&amp;0\\0&amp;0&amp;0&amp;0&amp;q_s\end{bmatrix} \end{pmatrix}  \\
\\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1&amp;0&amp;0&amp;0&amp;0\\0&amp;1&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;1&amp;0\\0&amp;0&amp;0&amp;0&amp;1\end{bmatrix}
\begin{bmatrix}x_{1,t}\\x_{2,t}\\x_{3,t}\\x_{4,t}\\x_{5,t}\end{bmatrix}
+ \begin{bmatrix}0\\0\\0\\0\\0\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix},  \\
\\
\mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix} 0,\begin{bmatrix}0.01&amp;0&amp;0&amp;0&amp;0\\0&amp;0.01&amp;0&amp;0&amp;0\\0&amp;0&amp;0.01&amp;0&amp;0\\0&amp;0&amp;0&amp;0.01&amp;0\\0&amp;0&amp;0&amp;0&amp;0.01\end{bmatrix} \end{pmatrix} \\
\end{gather*}\]</span>
To fit this model, use the following code (output not shown):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">regions=<span class="kw">list</span>(<span class="st">&quot;N&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;S&quot;</span>,<span class="st">&quot;S&quot;</span>)</a>
<a class="sourceLine" id="cb22-2" title="2">U=<span class="kw">matrix</span>(regions,<span class="dv">5</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-3" title="3">Q=<span class="kw">matrix</span>(<span class="kw">list</span>(<span class="dv">0</span>),<span class="dv">5</span>,<span class="dv">5</span>); <span class="kw">diag</span>(Q)=regions</a>
<a class="sourceLine" id="cb22-4" title="4">R=<span class="kw">diag</span>(<span class="fl">0.01</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb22-5" title="5">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">U=</span>U, <span class="dt">Q=</span>Q, <span class="dt">R=</span>R))</a></code></pre></div>
</div>
<div id="one-hidden-state-and-five-i.i.d.-observation-time-series" class="section level3">
<h3><span class="header-section-number">4.2.6</span> One hidden state and five i.i.d. observation time series</h3>
<p>Instead of five hidden state trajectories, we specify that there is only one and all the observations are of that one trajectory. Mathematically, the model is:
<span class="math display">\[\begin{gather*}
x_{t}= x_{t-1} + u + w_{t}, \text{ } w_t \sim \,\text{N}(0,q)  \\  \\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1\\1\\1\\1\\1\end{bmatrix}
x_{t} + \begin{bmatrix}0\\a_2\\a_3\\a_4\\a_5\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix},
 \textrm{ } \mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix}0,\begin{bmatrix}r&amp;0&amp;0&amp;0&amp;0\\0&amp;r&amp;0&amp;0&amp;0\\0&amp;0&amp;r&amp;0&amp;0\\0&amp;0&amp;0&amp;r&amp;0\\0&amp;0&amp;0&amp;0&amp;r\end{bmatrix} \end{pmatrix}  \\
\end{gather*}\]</span>
Note the default model for <span class="math inline">\(\mathbf{R}\)</span> is <code>"diagonal and equal"</code>’ so we can leave this off when specifying the <code>model</code> argument. To fit, use this code (output not shown):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">Z=<span class="kw">factor</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb23-2" title="2">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">Z=</span>Z))</a></code></pre></div>
<pre><code>Success! abstol and log-log tests passed at 28 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 28 iterations. 
Log-likelihood: 3.593276 
AIC: 8.813447   AICc: 11.13603   
 
        Estimate
A.SJI    0.80153
A.EBays  0.28245
A.PSnd  -0.54802
A.HC    -0.62665
R.diag   0.04523
U.U      0.04759
Q.Q      0.00429
x0.x0    6.39199
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
<p>You can also pass in <span class="math inline">\(\mathbf{Z}\)</span> exactly as it is in the equation: <code>Z=matrix(1,5,2)</code>, but the factor shorthand is handy if you need to assign different observed time series to different underlying state time series (see next examples). The default <span class="math inline">\(\mathbf{a}\)</span> form is <code>"scaling"</code>, which means that the first <span class="math inline">\(\mathbf{y}\)</span> row associated with a given <span class="math inline">\(x\)</span> has <span class="math inline">\(a=0\)</span> and the rest are estimated.</p>
</div>
<div id="one-hidden-state-and-five-independent-observation-time-series-with-different-variances" class="section level3">
<h3><span class="header-section-number">4.2.7</span> One hidden state and five independent observation time series with different variances</h3>
<p>Mathematically, this model is:
<span class="math display">\[\begin{gather*}
x_{t}= x_{t-1} + u + w_{t}, \text{ } w_t \sim \,\text{N}(0,q)  \\
\\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1\\1\\1\\1\\1\end{bmatrix}
x_{t} + \begin{bmatrix}0\\a_2\\a_3\\a_4\\a_5\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix}, 
 \textrm{ } \mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix} 0,\begin{bmatrix}r_1&amp;0&amp;0&amp;0&amp;0\\0&amp;r_2&amp;0&amp;0&amp;0\\0&amp;0&amp;r_3&amp;0&amp;0\\0&amp;0&amp;0&amp;r_4&amp;0\\0&amp;0&amp;0&amp;0&amp;r_5\end{bmatrix} \end{pmatrix}  \\
\end{gather*}\]</span>
To fit this model: </p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">Z=<span class="kw">factor</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb25-2" title="2">R=<span class="st">&quot;diagonal and unequal&quot;</span></a>
<a class="sourceLine" id="cb25-3" title="3">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">Z=</span>Z, <span class="dt">R=</span>R))</a></code></pre></div>
<pre><code>Success! abstol and log-log tests passed at 24 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 24 iterations. 
Log-likelihood: 16.66199 
AIC: -9.323982   AICc: -3.944671   
 
                Estimate
A.SJI            0.79555
A.EBays          0.27540
A.PSnd          -0.53694
A.HC            -0.60874
R.(SJF,SJF)      0.03229
R.(SJI,SJI)      0.03528
R.(EBays,EBays)  0.01352
R.(PSnd,PSnd)    0.01082
R.(HC,HC)        0.19609
U.U              0.05270
Q.Q              0.00604
x0.x0            6.26676
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
</div>
<div id="two-hidden-state-processes" class="section level3">
<h3><span class="header-section-number">4.2.8</span> Two hidden state processes</h3>
<p>Here we fit a model with two hidden states (north and south) where observation time series 1-3 are for the north and 4-5 are for the south. We make the hidden state processes independent (meaning a diagonal <span class="math inline">\(\mathbf{Q}\)</span> matrix) but with the same process variance. We make the observation errors i.i.d. (the default) and the <span class="math inline">\(\mathbf{u}\)</span> elements equal. Mathematically, this is the model:
<span class="math display">\[\begin{gather*}
\begin{bmatrix}x_{n,t}\\x_{s,t}\end{bmatrix}
= \begin{bmatrix}x_{n,t-1}\\x_{s,t-1}\end{bmatrix}
+ \begin{bmatrix}u\\u\end{bmatrix}
+ \begin{bmatrix}w_{n,t}\\w_{s,t}\end{bmatrix},   
 \textrm{ } \mathbf{w}_t \sim \,\text{MVN}\begin{pmatrix} 0,
 \begin{bmatrix}q&amp;0\\0&amp;q\end{bmatrix} \end{pmatrix} \\
\\
\begin{bmatrix}y_{1,t}\\y_{2,t}\\y_{3,t}\\y_{4,t}\\y_{5,t}\end{bmatrix}
= \begin{bmatrix}1&amp;0\\1&amp;0\\1&amp;0\\0&amp;1\\0&amp;1\end{bmatrix}
\begin{bmatrix}x_{n,t}\\x_{s,t}\end{bmatrix}
+ \begin{bmatrix}0\\a_2\\a_3\\0\\a_5\end{bmatrix}
+ \begin{bmatrix}v_{1,t}\\ v_{2,t}\\ v_{3,t}\\ v_{4,t}\\ v_{5,t}\end{bmatrix}, 
 \textrm{ } \mathbf{v}_t \sim \,\text{MVN}\begin{pmatrix}0,\begin{bmatrix}r&amp;0&amp;0&amp;0&amp;0\\0&amp;r&amp;0&amp;0&amp;0\\0&amp;0&amp;r&amp;0&amp;0\\0&amp;0&amp;0&amp;r&amp;0\\0&amp;0&amp;0&amp;0&amp;r\end{bmatrix} \end{pmatrix}  \\
\end{gather*}\]</span>
To fit the model, use the following code (output not shown):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">Z=<span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;N&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;S&quot;</span>,<span class="st">&quot;S&quot;</span>))</a>
<a class="sourceLine" id="cb27-2" title="2">Q=<span class="st">&quot;diagonal and equal&quot;</span></a>
<a class="sourceLine" id="cb27-3" title="3">U=<span class="st">&quot;equal&quot;</span></a>
<a class="sourceLine" id="cb27-4" title="4">kemfit =<span class="st"> </span><span class="kw">MARSS</span>(dat, <span class="dt">model=</span><span class="kw">list</span>(<span class="dt">Z=</span>Z,<span class="dt">Q=</span>Q,<span class="dt">U=</span>U))</a></code></pre></div>
<p>You can also pass in <span class="math inline">\(\mathbf{Z}\)</span> exactly as it is in the equation as a numeric matrix <code>Z=matrix(c(1,1,1,0,0,0,0,0,1,1),5,2)</code>; the <code>factor</code> notation is a shortcut for making a design matrix (as <span class="math inline">\(\mathbf{Z}\)</span> is in these examples. <code>"equal"</code> is a shortcut meaning all elements in a matrix are constrained to be equal. It can be used for all column matrices (<span class="math inline">\(\mathbf{a}\)</span>, <span class="math inline">\(\mathbf{u}\)</span> and <span class="math inline">\(\boldsymbol{\pi}\)</span>). <code>"diagonal and equal"</code> can be used as a shortcut for all square matrices (<span class="math inline">\(\mathbf{B}\)</span>,<span class="math inline">\(\mathbf{Q}\)</span>,<span class="math inline">\(\mathbf{R}\)</span>, and <span class="math inline">\(\boldsymbol{\Lambda}\)</span>).</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fixed-and-estimated-elements-in-parameter-matrices.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time-varying-parameters.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nwfsc-timeseries/MARSS-Manual/blob/master/cleanedRmd/03-short-examples.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["MARSS_Manual.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

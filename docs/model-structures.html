<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.4 Model structures | MARSS Package Manual</title>
  <meta name="description" content="This is the online manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MARSS Modeling for Environmenal Data by Holmes, Scheuerell and Ward." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4.4 Model structures | MARSS Package Manual" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="This is the online manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MARSS Modeling for Environmenal Data by Holmes, Scheuerell and Ward." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.4 Model structures | MARSS Package Manual" />
  
  <meta name="twitter:description" content="This is the online manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MARSS Modeling for Environmenal Data by Holmes, Scheuerell and Ward." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="E. E. Holmes, M. D. Scheuerell, and E. J. Ward" />


<meta name="date" content="2021-02-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="time-varying-parameters.html"/>
<link rel="next" href="chap-covariates.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MARSS Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>Citation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li><a href="part1.html#part1"><i style="font-size: 110%; color:#990017;">Part 1. Overview</i></a></li>
<li class="chapter" data-level="1" data-path="chap-overview.html"><a href="chap-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="marss-model-form.html"><a href="marss-model-form.html"><i class="fa fa-check"></i><b>1.1</b> MARSS model form</a></li>
<li class="chapter" data-level="1.2" data-path="examples-of-marss-models.html"><a href="examples-of-marss-models.html"><i class="fa fa-check"></i><b>1.2</b> Examples of MARSS models</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-quick-start.html"><a href="chap-quick-start.html"><i class="fa fa-check"></i><b>2</b> Quick Start</a>
<ul>
<li class="chapter" data-level="2.1" data-path="linear-constraints.html"><a href="linear-constraints.html"><i class="fa fa-check"></i><b>2.1</b> Linear constraints</a></li>
<li class="chapter" data-level="2.2" data-path="important.html"><a href="important.html"><i class="fa fa-check"></i><b>2.2</b> Important</a></li>
<li class="chapter" data-level="2.3" data-path="time-varying-parameters-and-inputs.html"><a href="time-varying-parameters-and-inputs.html"><i class="fa fa-check"></i><b>2.3</b> Time-varying parameters and inputs</a></li>
<li class="chapter" data-level="2.4" data-path="inputs.html"><a href="inputs.html"><i class="fa fa-check"></i><b>2.4</b> Inputs</a></li>
<li class="chapter" data-level="2.5" data-path="outputs.html"><a href="outputs.html"><i class="fa fa-check"></i><b>2.5</b> Outputs</a></li>
<li class="chapter" data-level="2.6" data-path="tips-and-tricks.html"><a href="tips-and-tricks.html"><i class="fa fa-check"></i><b>2.6</b> Tips and Tricks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-input.html"><a href="chap-input.html"><i class="fa fa-check"></i><b>3</b> Data format</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ts-objects.html"><a href="ts-objects.html"><i class="fa fa-check"></i><b>3.1</b> <strong>ts</strong> objects</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ts-objects.html"><a href="ts-objects.html#univariate-ts-object"><i class="fa fa-check"></i><b>3.1.1</b> Univariate <strong>ts</strong> object</a></li>
<li class="chapter" data-level="3.1.2" data-path="ts-objects.html"><a href="ts-objects.html#multivariate-ts-object"><i class="fa fa-check"></i><b>3.1.2</b> Multivariate <strong>ts</strong> object</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tsibble-objects.html"><a href="tsibble-objects.html"><i class="fa fa-check"></i><b>3.2</b> <strong>tsibble</strong> objects</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-model-list.html"><a href="chap-model-list.html"><i class="fa fa-check"></i><b>4</b> Specifying the model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="general-matrix-specification.html"><a href="general-matrix-specification.html"><i class="fa fa-check"></i><b>4.1</b> General matrix specification</a></li>
<li class="chapter" data-level="4.2" data-path="linear-constraints-1.html"><a href="linear-constraints-1.html"><i class="fa fa-check"></i><b>4.2</b> Linear constraints</a></li>
<li class="chapter" data-level="4.3" data-path="time-varying-parameters.html"><a href="time-varying-parameters.html"><i class="fa fa-check"></i><b>4.3</b> Time-varying parameters</a></li>
<li class="chapter" data-level="4.4" data-path="model-structures.html"><a href="model-structures.html"><i class="fa fa-check"></i><b>4.4</b> Model structures</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="model-structures.html"><a href="model-structures.html#mathbfu-mathbfa-and-boldsymbolpi"><i class="fa fa-check"></i><b>4.4.1</b> <span class="math inline">\(\mathbf{u}\)</span>, <span class="math inline">\(\mathbf{a}\)</span> and <span class="math inline">\(\boldsymbol{\pi}\)</span></a></li>
<li class="chapter" data-level="4.4.2" data-path="model-structures.html"><a href="model-structures.html#mathbfq-mathbfr-boldsymbollambda"><i class="fa fa-check"></i><b>4.4.2</b> <span class="math inline">\(\mathbf{Q}\)</span>, <span class="math inline">\(\mathbf{R}\)</span>, <span class="math inline">\(\boldsymbol{\Lambda}\)</span></a></li>
<li class="chapter" data-level="4.4.3" data-path="model-structures.html"><a href="model-structures.html#mathbfb"><i class="fa fa-check"></i><b>4.4.3</b> <span class="math inline">\(\mathbf{B}\)</span></a></li>
<li class="chapter" data-level="4.4.4" data-path="model-structures.html"><a href="model-structures.html#mathbfz"><i class="fa fa-check"></i><b>4.4.4</b> <span class="math inline">\(\mathbf{Z}\)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-covariates.html"><a href="chap-covariates.html"><i class="fa fa-check"></i><b>5</b> Covariates format</a>
<ul>
<li class="chapter" data-level="5.1" data-path="factor-covariates.html"><a href="factor-covariates.html"><i class="fa fa-check"></i><b>5.1</b> Factor covariates</a></li>
</ul></li>
<li><a href="part2.html#part2"><i style="font-size: 110%; color:#990017;">Part 2. Examples</i></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="part2.html"><a href="part2.html"><i class="fa fa-check"></i><b>5.1.1</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-uss.html"><a href="chap-uss.html"><i class="fa fa-check"></i><b>6</b> Univariate Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="random-walk-with-drift.html"><a href="random-walk-with-drift.html"><i class="fa fa-check"></i><b>6.1</b> Random walk with drift</a></li>
<li class="chapter" data-level="6.2" data-path="random-walk-with-time-varying-parameters.html"><a href="random-walk-with-time-varying-parameters.html"><i class="fa fa-check"></i><b>6.2</b> Random walk with time-varying parameters</a></li>
<li class="chapter" data-level="6.3" data-path="ar1-observed-with-error.html"><a href="ar1-observed-with-error.html"><i class="fa fa-check"></i><b>6.3</b> AR(1) observed with error</a></li>
<li class="chapter" data-level="6.4" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>6.4</b> Linear regression</a></li>
<li class="chapter" data-level="6.5" data-path="linear-regression-with-ar1-errors.html"><a href="linear-regression-with-ar1-errors.html"><i class="fa fa-check"></i><b>6.5</b> Linear regression with AR(1) errors</a></li>
<li class="chapter" data-level="6.6" data-path="linear-regression-with-ar1-errors-and-independent-errors.html"><a href="linear-regression-with-ar1-errors-and-independent-errors.html"><i class="fa fa-check"></i><b>6.6</b> Linear regression with AR(1) errors and independent errors</a></li>
<li class="chapter" data-level="6.7" data-path="linear-regression-with-ar1-driven-by-covariate.html"><a href="linear-regression-with-ar1-driven-by-covariate.html"><i class="fa fa-check"></i><b>6.7</b> Linear regression with AR(1) driven by covariate</a></li>
<li class="chapter" data-level="6.8" data-path="flat-level-model.html"><a href="flat-level-model.html"><i class="fa fa-check"></i><b>6.8</b> Flat level model</a></li>
<li class="chapter" data-level="6.9" data-path="linear-trend-model.html"><a href="linear-trend-model.html"><i class="fa fa-check"></i><b>6.9</b> Linear trend model</a></li>
<li class="chapter" data-level="6.10" data-path="stochastic-level-model.html"><a href="stochastic-level-model.html"><i class="fa fa-check"></i><b>6.10</b> Stochastic level model</a></li>
<li class="chapter" data-level="6.11" data-path="stochastic-slope-model.html"><a href="stochastic-slope-model.html"><i class="fa fa-check"></i><b>6.11</b> Stochastic slope model</a></li>
</ul></li>
<li><a href="part3.html#part3"><i style="font-size: 110%; color:#990017;">Part 3. Outputs</i></a></li>
<li class="chapter" data-level="7" data-path="chap-outputs.html"><a href="chap-outputs.html"><i class="fa fa-check"></i><b>7</b> MARSS outputs</a></li>
<li class="chapter" data-level="8" data-path="chap-residuals.html"><a href="chap-residuals.html"><i class="fa fa-check"></i><b>8</b> MARSS Residuals</a></li>
<li class="chapter" data-level="9" data-path="chap-CIs.html"><a href="chap-CIs.html"><i class="fa fa-check"></i><b>9</b> Confidence Intervals</a></li>
<li class="chapter" data-level="10" data-path="chap-predictions.html"><a href="chap-predictions.html"><i class="fa fa-check"></i><b>10</b> Predictions</a></li>
<li><a href="part4.html#part4"><i style="font-size: 110%; color:#990017;">Part 4. Tips and Tricks</i></a></li>
<li class="chapter" data-level="11" data-path="chap-troubleshooting.html"><a href="chap-troubleshooting.html"><i class="fa fa-check"></i><b>11</b> Troubleshooting</a></li>
<li class="chapter" data-level="12" data-path="chap-EM-algorithm.html"><a href="chap-EM-algorithm.html"><i class="fa fa-check"></i><b>12</b> EM algorithm</a>
<ul>
<li class="chapter" data-level="12.1" data-path="important-notes-about-the-algorithms.html"><a href="important-notes-about-the-algorithms.html"><i class="fa fa-check"></i><b>12.1</b> Important notes about the algorithms</a></li>
<li class="chapter" data-level="12.2" data-path="state-space-form-of-armapq-models.html"><a href="state-space-form-of-armapq-models.html"><i class="fa fa-check"></i><b>12.2</b> State-space form of ARMA(p,q) models</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chap-other-packages.html"><a href="chap-other-packages.html"><i class="fa fa-check"></i><b>13</b> Other related packages</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li style="font-weight: normal"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MARSS Package Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-structures" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Model structures</h2>
<div id="mathbfu-mathbfa-and-boldsymbolpi" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> <span class="math inline">\(\mathbf{u}\)</span>, <span class="math inline">\(\mathbf{a}\)</span> and <span class="math inline">\(\boldsymbol{\pi}\)</span></h3>
<p><span class="math inline">\(\mathbf{u}\)</span>, <span class="math inline">\(\mathbf{a}\)</span> and <span class="math inline">\(\boldsymbol{\pi}\)</span> are all row matrices and the options for specifying their structures are the same. <span class="math inline">\(\mathbf{a}\)</span> has one special option, <code>"scaling"</code> described below. The allowable structures are shown using <span class="math inline">\(\mathbf{u}\)</span> as an example. Note that you should be careful about specifying shared structure in <span class="math inline">\(\boldsymbol{\pi}\)</span> because you need to make sure the structure in <span class="math inline">\(\boldsymbol{\Lambda}\)</span> matches. For example, if you require that all the <span class="math inline">\(\boldsymbol{\pi}\)</span> values are shared (equal) then <span class="math inline">\(\boldsymbol{\Lambda}\)</span> cannot be a diagonal matrix since that would be saying that the <span class="math inline">\(\boldsymbol{\pi}\)</span> values are independent, which they are clearly not if you force them to be equal.</p>
<ul>
<li><p><code>U=matrix(list(),m,1)</code>: This is the most general form and allows one to specify fixed and estimated elements in <span class="math inline">\(\mathbf{u}\)</span>. Each character string in <span class="math inline">\(\mathbf{u}\)</span> is the name of one of the <span class="math inline">\(\mathbf{u}\)</span> elements to be estimated. For example if <code>U=matrix(list(0.01,"u","u"),3,1)</code>, then <span class="math inline">\(\mathbf{u}\)</span> in the model has the following structure:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{c}
  0.01 \\
  u \\
  u \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>U=matrix(c(),m,1)</code>, where the values in <code>c()</code> are all character strings: each character string is the name of an element to be estimated. For example if <code>U=matrix(c("u1","u1","u2"),3,1)</code>, then <span class="math inline">\(\mathbf{u}\)</span> in the model has the following structure:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{c}
  u_1 \\
  u_1 \\
  u_2 \end{array} \right]
\end{equation*}\]</span>
with two values being estimated. <code>U=matrix(list("u1","u1","u2"),3,1)</code> has the same effect.</p></li>
<li><p><code>U="unequal"</code> or <code>U="unconstrained"</code>: Both of these stings indicate that each element of <span class="math inline">\(\mathbf{u}\)</span> is estimated. If <span class="math inline">\(m=3\)</span>, then <span class="math inline">\(\mathbf{u}\)</span> would have the form:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{c}
  u_1\\
  u_2\\
  u_3 \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>U="equal"</code>: There is only one value in <span class="math inline">\(\mathbf{u}\)</span>:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{c}
  u \\
  u \\
  u \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>U=matrix(c(),m,1)</code>, where the values in <code>c()</code> are all numerical values: <span class="math inline">\(\mathbf{u}\)</span> is fixed and has no estimated values. If <code>U=matrix(c(0.01,1,-0.5),3,1)</code>, then <span class="math inline">\(\mathbf{u}\)</span> in the model is:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{c}
  0.01 \\
  1 \\
  -0.5 \end{array} \right]
\end{equation*}\]</span>
<code>U=matrix(list(0.01,1,-0.5),3,1)</code> would have the same effect.</p></li>
<li><p><code>U="zero"</code>: <span class="math inline">\(\mathbf{u}\)</span> is all zero:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{c}
  0 \\
  0 \\
  0 \end{array} \right]
\end{equation*}\]</span></p></li>
</ul>
<p>The <span class="math inline">\(\mathbf{a}\)</span> parameter has a special option, <code>"scaling"</code>, which is the default behavior. In this case, <span class="math inline">\(\mathbf{a}\)</span> is treated like a scaling parameter. If there is only one <span class="math inline">\(\mathbf{y}\)</span> row associated with an <span class="math inline">\(\mathbf{x}\)</span> row, then the corresponding <span class="math inline">\(\mathbf{a}\)</span> element is 0. If there are more than one <span class="math inline">\(\mathbf{y}\)</span> rows associated with an <span class="math inline">\(\mathbf{x}\)</span> row, then the first <span class="math inline">\(\mathbf{a}\)</span> element is set to 0 and the others are estimated. For example, say <span class="math inline">\(m=2\)</span> and <span class="math inline">\(n=4\)</span> and <span class="math inline">\(\mathbf{Z}\)</span> looks like the following:
<span class="math display">\[\begin{equation*}
 \mathbf{Z} =
  \left[ \begin{array}{cc}
    1 &amp; 0  \\
    1 &amp; 0  \\
    1 &amp; 0  \\
    0 &amp; 1  \end{array} \right]
\end{equation*}\]</span>
Then the 1st-3rd rows of <span class="math inline">\(\mathbf{y}\)</span> are associated with the first row of <span class="math inline">\(\mathbf{x}\)</span>, and the 4th row of <span class="math inline">\(\mathbf{y}\)</span> is associated with the last row of <span class="math inline">\(\mathbf{x}\)</span>. Then if <span class="math inline">\(\mathbf{a}\)</span> is specified as <code>"scaling"</code>, <span class="math inline">\(\mathbf{a}\)</span> has the following structure:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{c}
    0 \\
    a_1 \\
    a_2 \\
    0 \end{array} \right]
\end{equation*}\]</span></p>
</div>
<div id="mathbfq-mathbfr-boldsymbollambda" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> <span class="math inline">\(\mathbf{Q}\)</span>, <span class="math inline">\(\mathbf{R}\)</span>, <span class="math inline">\(\boldsymbol{\Lambda}\)</span></h3>
<p>The possible <span class="math inline">\(\mathbf{Q}\)</span>, <span class="math inline">\(\mathbf{R}\)</span>, and <span class="math inline">\(\boldsymbol{\Lambda}\)</span> model structures are identical, except that <span class="math inline">\(\mathbf{R}\)</span> is <span class="math inline">\(n \times n\)</span> while <span class="math inline">\(\mathbf{Q}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span> are <span class="math inline">\(m \times m\)</span>. All types of structures can be specified using a list matrix, but there are also text shortcuts for specifying common structures. The structures are shown using <span class="math inline">\(\mathbf{Q}\)</span> as the example.</p>
<ul>
<li><code>Q=matrix(list(),m,m)</code>: This is the most general way to specify the parameters and allows there to be fixed and estimated elements. Each character string in the list matrix is the name of one of the <span class="math inline">\(\mathbf{Q}\)</span> elements to be estimated, and each numerical value is a fixed value. For example if</li>
</ul>
<pre><code>Q=matrix(list(&quot;s2a&quot;,0,0,0,&quot;s2a&quot;,0,0,0,&quot;s2b&quot;),3,3)</code></pre>
<p>then <span class="math inline">\(\mathbf{Q}\)</span> has the following structure:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{ccc}
    \sigma^2_a &amp; 0 &amp; 0\\
    0 &amp; \sigma^2_a &amp; 0 \\
    0 &amp; 0 &amp; \sigma^2_b \end{array} \right]
\end{equation*}\]</span>
Note that <code>diag(c("s2a","s2a","s2b"))</code> will not have the desired effect of producing a matrix with numeric 0s on the off-diagonals. It will have character 0s and MARSS will interpret <code>"0"</code> as the name of an element of <span class="math inline">\(\mathbf{Q}\)</span> to be estimated. Instead, the following two lines can be used:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="model-structures.html#cb20-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">list</span>(<span class="dv">0</span>),<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb20-2"><a href="model-structures.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(Q)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;s2a&quot;</span>,<span class="st">&quot;s2a&quot;</span>,<span class="st">&quot;s2b&quot;</span>)</span></code></pre></div>
<ul>
<li><p><code>Q="diagonal and equal"</code>: There is only one process variance value in this case:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{ccc}
  \sigma^2 &amp; 0 &amp; 0\\
  0 &amp; \sigma^2 &amp; 0 \\
  0 &amp; 0 &amp; \sigma^2 \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>Q="diagonal and unequal"</code>: There are <span class="math inline">\(m\)</span> process variance values in this case:<br />
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{ccc}
  \sigma^2_1 &amp; 0 &amp; 0\\
  0 &amp; \sigma^2_2 &amp; 0 \\
  0 &amp; 0 &amp; \sigma^2_3 \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>Q="unconstrained"</code>: There are values on the diagonal and the off-diagonals of <span class="math inline">\(\mathbf{Q}\)</span> and the variances and covariances are all different:<br />
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{ccc}
  \sigma^2_1 &amp; \sigma_{1,2} &amp; \sigma_{1,3}\\
  \sigma_{1,2} &amp; \sigma^2_2 &amp; \sigma_{2,3} \\
  \sigma_{1,3} &amp; \sigma_{2,3} &amp; \sigma^2_3 \end{array} \right]
\end{equation*}\]</span>
There are <span class="math inline">\(m\)</span> process variances and <span class="math inline">\((m^2-m)/2\)</span> covariances in this case, so <span class="math inline">\((m^2+m)/2\)</span> values to be estimated. Note that variance-covariance matrices are never truly unconstrained since the upper and lower triangles of the matrix must be equal.</p></li>
<li><p><code>Q="equalvarcov"</code>: There is one process variance and one covariance:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{ccc}
  \sigma^2 &amp; \beta &amp; \beta\\
  \beta &amp; \sigma^2 &amp; \beta \\
  \beta &amp; \beta &amp; \sigma^2 \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>Q=matrix(c(), m, m)</code>, where all values in <code>c()</code> are character strings: Each element in <span class="math inline">\(\mathbf{Q}\)</span> is estimated and each character string is the name of a value to be estimated. Note if <span class="math inline">\(m=1\)</span>, you still need to wrap its value in <code>matrix()</code> so that its class is matrix. You must be careful that your <span class="math inline">\(\mathbf{Q}\)</span> specifies a statistically valid variance-covariance matrix. <code>MARSS()</code> will throw an error/warning telling you if it is not valid.</p></li>
<li><p><code>Q=matrix(c(), m, m)</code>, where all values in <code>c()</code> are numeric values: Each element in <span class="math inline">\(\mathbf{Q}\)</span> is fixed to the values in the matrix.</p></li>
<li><p><code>Q="identity"</code>: The <span class="math inline">\(\mathbf{Q}\)</span> matrix is the identity matrix:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{ccc}
  1 &amp; 0 &amp; 0\\
  0 &amp; 1 &amp; 0 \\
  0 &amp; 0 &amp; 1 \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>Q="zero"</code>: The <span class="math inline">\(\mathbf{Q}\)</span> matrix is all zeros:
<span class="math display">\[\begin{equation*}
 \left[ \begin{array}{ccc}
  0 &amp; 0 &amp; 0\\
  0 &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 0 \end{array} \right]
\end{equation*}\]</span>
\end{itemize}</p></li>
</ul>
<p>Be careful when setting <span class="math inline">\(\boldsymbol{\Lambda}\)</span> model structures. Mis-specifying the structure of <span class="math inline">\(\boldsymbol{\Lambda}\)</span> can have catastrophic, but difficult to discern, effects on your estimates. The default behavior for <span class="math inline">\(\boldsymbol{\Lambda}\)</span> is safe.</p>
</div>
<div id="mathbfb" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> <span class="math inline">\(\mathbf{B}\)</span></h3>
<p>Like the variance-covariance matrices (<span class="math inline">\(\mathbf{Q}\)</span>, <span class="math inline">\(\mathbf{R}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span>), <span class="math inline">\(\mathbf{B}\)</span> can be specified with a list matrix to allow you to have both fixed and shared elements in the <span class="math inline">\(\mathbf{B}\)</span> matrix. Character matrices and matrices with fixed values operate the same way as for the variance-covariance matrices. In addition, the same text shortcuts are available: <code>"unconstrained"</code>, <code>"identity"</code>, <code>"diagonal and equal"</code>, <code>"diagonal and unequal"</code>, <code>"equalvarcov"</code>, and <code>"zero"</code>. A fixed <span class="math inline">\(\mathbf{B}\)</span> can be specified with a numeric matrix, but all eigenvalues must fall within the unit circle; meaning <code>ll(abs(eigen(B)\$values)&lt;=1)</code> must be true.</p>
</div>
<div id="mathbfz" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> <span class="math inline">\(\mathbf{Z}\)</span></h3>
<p>Like <span class="math inline">\(\mathbf{B}\)</span> and the variance-covariance matrices, <span class="math inline">\(\mathbf{Z}\)</span> can be specified with a list matrix to allow you to have both fixed and estimated elements in <span class="math inline">\(\mathbf{Z}\)</span>. If <span class="math inline">\(\mathbf{Z}\)</span> is a square matrix, many of the same text shortcuts are available: <code>"diagonal and equal"</code>, <code>"diagonal and equal"</code>, and <code>"equalvarcov"</code>. If <span class="math inline">\(\mathbf{Z}\)</span> is a design matrix (a matrix with only 0s and 1s and where the row sums are all equal to 1), then a special shortcut is available using <code>factor()</code> which allows you to specify which <span class="math inline">\(\mathbf{y}\)</span> rows are associated with which <span class="math inline">\(\mathbf{x}\)</span> rows.</p>
<ul>
<li><p><code>Z=factor(c(1,1,1))</code>: All <span class="math inline">\(\mathbf{y}\)</span> time series are observing the same (and only) hidden state trajectory <span class="math inline">\(x\)</span> (<span class="math inline">\(n=3\)</span> and <span class="math inline">\(m=1\)</span>):
<span class="math display">\[\begin{equation*}
 \mathbf{Z} =
 \left[ \begin{array}{c}
  1  \\
  1  \\
  1  
  \end{array} \right]  
\end{equation*}\]</span></p></li>
<li><p><code>Z=factor(c(1,2,3))</code>: Each time series in <span class="math inline">\(\mathbf{y}\)</span> corresponds to a different hidden state trajectory. This is the default <span class="math inline">\(\mathbf{Z}\)</span> model and in this case <span class="math inline">\(n=m\)</span>:
<span class="math display">\[\begin{equation*}
 \mathbf{Z} =
\left[ \begin{array}{ccc}
  1 &amp; 0 &amp; 0 \\
  0 &amp; 1 &amp; 0 \\
  0 &amp; 0 &amp; 1 \end{array} \right]
\end{equation*}\]</span></p></li>
<li><p><code>Z=factor(c(1,1,2))</code>: The first two time series in <span class="math inline">\(\mathbf{y}\)</span> corresponds to one hidden state trajectory and the third <span class="math inline">\(\mathbf{y}\)</span> time series corresponds to a different hidden state trajectory. Here <span class="math inline">\(n=3\)</span> and <span class="math inline">\(m=2\)</span>:
<span class="math display">\[\begin{equation*}
 \mathbf{Z} =
\left[ \begin{array}{cc}
  1 &amp; 0  \\
  1 &amp; 0  \\
  0 &amp; 1  \end{array} \right]
\end{equation*}\]</span>
The <span class="math inline">\(\mathbf{Z}\)</span> model can be specified using either numeric or character factor levels. <code>c(1,1,2)</code> is the same as <code>c("north","north","south")</code>.</p></li>
<li><p><code>Z="identity"</code>: This is the default behavior. This means <span class="math inline">\(\mathbf{Z}\)</span> is a <span class="math inline">\(n \times n\)</span> identity matrix and <span class="math inline">\(m=n\)</span>. If <span class="math inline">\(n=3\)</span>, it is the same as <code>Z=factor(c(1,2,3))</code>.</p></li>
<li><p><code>Z=matrix(c(), n, m)</code>, where the elements in <code>c()</code> are all character strings: Passing in a <span class="math inline">\(n \times m\)</span> character matrix, means that each character string is a value to be estimated. Be careful that you are specifying an identifiable model when using this option.</p></li>
<li><p><code>Z=matrix(c(), n, m)</code>, where the elements in <code>c()</code> are all numeric: Passing in a <span class="math inline">\(n \times m\)</span> numeric matrix means that <span class="math inline">\(\mathbf{Z}\)</span> is fixed to the values in the matrix. The matrix must be numeric but it does not need to be a design matrix.</p></li>
<li><p><code>Z=matrix(list(), n, m)</code>: Passing in a <span class="math inline">\(n \times m\)</span> list matrix allows you to combine fixed and estimated values in the <span class="math inline">\(\mathbf{Z}\)</span> matrix. Be careful that you are specifying an identifiable model.</p></li>
</ul>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="time-varying-parameters.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chap-covariates.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nwfsc-timeseries/MARSS-Manual/blob/master/cleanedRmd/04-1-model-list.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MARSS_Manual.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

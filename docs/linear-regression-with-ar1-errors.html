<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6.5 Linear regression with AR(1) errors | MARSS R Package</title>
  <meta name="description" content="This is the online manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MAR Modeling for Environmenal Science by Holmes, Scheuerell and Ward." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6.5 Linear regression with AR(1) errors | MARSS R Package" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="This is the online manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MAR Modeling for Environmenal Science by Holmes, Scheuerell and Ward." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6.5 Linear regression with AR(1) errors | MARSS R Package" />
  
  <meta name="twitter:description" content="This is the online manual for the MARSS R package. It covers the package functions, input and output, residuals, prediction, error messages and troubleshooting. For vignettes showing different applications of MARSS models, including Dynamic Factor Analysis and Dynamic Linear Models, please see the companion book MAR Modeling for Environmenal Science by Holmes, Scheuerell and Ward." />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Elizabeth E. Holmes, Eric J. Ward, Mark D. Scheuerell, and K. Wills" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="linear-regression.html"/>
<link rel="next" href="linear-regression-with-ar1-errors-and-independent-errors.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MARSS Package Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i>Installation</a></li>
<li class="chapter" data-level="" data-path="authors.html"><a href="authors.html"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="citation.html"><a href="citation.html"><i class="fa fa-check"></i>Citation</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li><a href="part1.html#part1"><i style="font-size: 110%; color:#990017;">Part 1. Overview</i></a></li>
<li class="chapter" data-level="1" data-path="chap-overview.html"><a href="chap-overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="marss-model-form.html"><a href="marss-model-form.html"><i class="fa fa-check"></i><b>1.1</b> MARSS model form</a></li>
<li class="chapter" data-level="1.2" data-path="example-model.html"><a href="example-model.html"><i class="fa fa-check"></i><b>1.2</b> Example model</a></li>
<li class="chapter" data-level="1.3" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>1.3</b> Notes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-quick-start.html"><a href="chap-quick-start.html"><i class="fa fa-check"></i><b>2</b> Quick Start</a>
<ul>
<li class="chapter" data-level="2.1" data-path="model-list.html"><a href="model-list.html"><i class="fa fa-check"></i><b>2.1</b> <code>model.list</code></a></li>
<li class="chapter" data-level="2.2" data-path="linear-constraints.html"><a href="linear-constraints.html"><i class="fa fa-check"></i><b>2.2</b> Linear constraints</a></li>
<li class="chapter" data-level="2.3" data-path="time-varying-parameters.html"><a href="time-varying-parameters.html"><i class="fa fa-check"></i><b>2.3</b> Time-varying parameters</a></li>
<li class="chapter" data-level="2.4" data-path="inputs-c-and-d.html"><a href="inputs-c-and-d.html"><i class="fa fa-check"></i><b>2.4</b> Inputs <code>c</code> and <code>d</code></a></li>
<li class="chapter" data-level="2.5" data-path="tips-and-tricks.html"><a href="tips-and-tricks.html"><i class="fa fa-check"></i><b>2.5</b> Tips and Tricks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-input.html"><a href="chap-input.html"><i class="fa fa-check"></i><b>3</b> Data format</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ts-objects.html"><a href="ts-objects.html"><i class="fa fa-check"></i><b>3.1</b> <code>ts</code> objects</a></li>
<li class="chapter" data-level="3.2" data-path="tsibble-objects.html"><a href="tsibble-objects.html"><i class="fa fa-check"></i><b>3.2</b> <code>tsibble</code> objects</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-model-list.html"><a href="chap-model-list.html"><i class="fa fa-check"></i><b>4</b> Model specification</a>
<ul>
<li class="chapter" data-level="4.1" data-path="general-matrix-specification.html"><a href="general-matrix-specification.html"><i class="fa fa-check"></i><b>4.1</b> General matrix specification</a></li>
<li class="chapter" data-level="4.2" data-path="linear-constraints-1.html"><a href="linear-constraints-1.html"><i class="fa fa-check"></i><b>4.2</b> Linear constraints</a></li>
<li class="chapter" data-level="4.3" data-path="time-varying-parameters-1.html"><a href="time-varying-parameters-1.html"><i class="fa fa-check"></i><b>4.3</b> Time-varying parameters</a></li>
<li class="chapter" data-level="4.4" data-path="examples-for-each-parameter.html"><a href="examples-for-each-parameter.html"><i class="fa fa-check"></i><b>4.4</b> Examples for each parameter</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-covariates.html"><a href="chap-covariates.html"><i class="fa fa-check"></i><b>5</b> Covariates format</a></li>
<li><a href="part2.html#part2"><i style="font-size: 110%; color:#990017;">Part 2. Examples</i></a></li>
<li class="chapter" data-level="6" data-path="chap-uss.html"><a href="chap-uss.html"><i class="fa fa-check"></i><b>6</b> Univariate Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="random-walk-with-drift.html"><a href="random-walk-with-drift.html"><i class="fa fa-check"></i><b>6.1</b> Random walk with drift</a></li>
<li class="chapter" data-level="6.2" data-path="random-walk-with-time-varying-parameters.html"><a href="random-walk-with-time-varying-parameters.html"><i class="fa fa-check"></i><b>6.2</b> Random walk with time-varying parameters</a></li>
<li class="chapter" data-level="6.3" data-path="ar1-observed-with-error.html"><a href="ar1-observed-with-error.html"><i class="fa fa-check"></i><b>6.3</b> AR(1) observed with error</a></li>
<li class="chapter" data-level="6.4" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>6.4</b> Linear regression</a></li>
<li class="chapter" data-level="6.5" data-path="linear-regression-with-ar1-errors.html"><a href="linear-regression-with-ar1-errors.html"><i class="fa fa-check"></i><b>6.5</b> Linear regression with AR(1) errors</a></li>
<li class="chapter" data-level="6.6" data-path="linear-regression-with-ar1-errors-and-independent-errors.html"><a href="linear-regression-with-ar1-errors-and-independent-errors.html"><i class="fa fa-check"></i><b>6.6</b> Linear regression with AR(1) errors and independent errors</a></li>
<li class="chapter" data-level="6.7" data-path="linear-regression-with-ar1-driven-by-covariate.html"><a href="linear-regression-with-ar1-driven-by-covariate.html"><i class="fa fa-check"></i><b>6.7</b> Linear regression with AR(1) driven by covariate</a></li>
<li class="chapter" data-level="6.8" data-path="flat-level-model.html"><a href="flat-level-model.html"><i class="fa fa-check"></i><b>6.8</b> Flat level model</a></li>
<li class="chapter" data-level="6.9" data-path="linear-trend-model.html"><a href="linear-trend-model.html"><i class="fa fa-check"></i><b>6.9</b> Linear trend model</a></li>
<li class="chapter" data-level="6.10" data-path="stochastic-level-model.html"><a href="stochastic-level-model.html"><i class="fa fa-check"></i><b>6.10</b> Stochastic level model</a></li>
<li class="chapter" data-level="6.11" data-path="stochastic-slope-model.html"><a href="stochastic-slope-model.html"><i class="fa fa-check"></i><b>6.11</b> Stochastic slope model</a></li>
</ul></li>
<li><a href="part3.html#part3"><i style="font-size: 110%; color:#990017;">Part 3. Outputs</i></a></li>
<li class="chapter" data-level="7" data-path="chap-params.html"><a href="chap-params.html"><i class="fa fa-check"></i><b>7</b> Parameter estimates</a></li>
<li class="chapter" data-level="8" data-path="chap-states.html"><a href="chap-states.html"><i class="fa fa-check"></i><b>8</b> States and smoothed <span class="math inline">\(\mathbf{y}\)</span></a></li>
<li class="chapter" data-level="9" data-path="chap-fitted.html"><a href="chap-fitted.html"><i class="fa fa-check"></i><b>9</b> Model fits</a></li>
<li class="chapter" data-level="10" data-path="chap-residuals.html"><a href="chap-residuals.html"><i class="fa fa-check"></i><b>10</b> Residuals</a></li>
<li class="chapter" data-level="11" data-path="chap-CIs.html"><a href="chap-CIs.html"><i class="fa fa-check"></i><b>11</b> Confidence Intervals</a></li>
<li class="chapter" data-level="12" data-path="chap-predictions.html"><a href="chap-predictions.html"><i class="fa fa-check"></i><b>12</b> Predictions and forecasts</a></li>
<li><a href="part4.html#part4"><i style="font-size: 110%; color:#990017;">Part 4. Tips and Tricks</i></a></li>
<li class="chapter" data-level="13" data-path="chap-troubleshooting.html"><a href="chap-troubleshooting.html"><i class="fa fa-check"></i><b>13</b> Troubleshooting</a></li>
<li class="chapter" data-level="14" data-path="chap-EM-algorithm.html"><a href="chap-EM-algorithm.html"><i class="fa fa-check"></i><b>14</b> EM algorithm</a>
<ul>
<li class="chapter" data-level="14.1" data-path="important-notes-about-the-algorithms.html"><a href="important-notes-about-the-algorithms.html"><i class="fa fa-check"></i><b>14.1</b> Important notes about the algorithms</a></li>
<li class="chapter" data-level="14.2" data-path="state-space-form-of-armapq-models.html"><a href="state-space-form-of-armapq-models.html"><i class="fa fa-check"></i><b>14.2</b> State-space form of ARMA(p,q) models</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="chap-other-packages.html"><a href="chap-other-packages.html"><i class="fa fa-check"></i><b>15</b> Other related packages</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li style="font-weight: normal"><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MARSS R Package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression-with-ar1-errors" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Linear regression with AR(1) errors</h2>
<p>A simple linear regression of one covariate with AR(1) errors is written:</p>
<p><span class="math display" id="eq:short-lr-ar1">\[\begin{equation}
\begin{gathered}
x_{t} = b x_{t-1} + w_{t}, \text{ } w_t \sim \,\text{N}(0,q)  \\
y_{t} = \beta d_t + x_{t}
\end{gathered}
\tag{6.7}
\end{equation}\]</span></p>
<p>Let’s create some simulated data with this structure:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="linear-regression-with-ar1-errors.html#cb80-1" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fl">1.1</span></span>
<span id="cb80-2"><a href="linear-regression-with-ar1-errors.html#cb80-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(TT, <span class="dv">0</span>, <span class="dv">1</span>)  <span class="co">#our covariate</span></span>
<span id="cb80-3"><a href="linear-regression-with-ar1-errors.html#cb80-3" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">n =</span> TT, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> b), <span class="at">sd =</span> <span class="fu">sqrt</span>(q))</span>
<span id="cb80-4"><a href="linear-regression-with-ar1-errors.html#cb80-4" aria-hidden="true" tabindex="-1"></a>yt <span class="ot">&lt;-</span> beta <span class="sc">*</span> dt <span class="sc">+</span> wt</span>
<span id="cb80-5"><a href="linear-regression-with-ar1-errors.html#cb80-5" aria-hidden="true" tabindex="-1"></a>yt <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(yt)  <span class="co"># not ts object</span></span>
<span id="cb80-6"><a href="linear-regression-with-ar1-errors.html#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dt, yt)</span></code></pre></div>
<p><img src="MARSS_Manual_files/figure-html/quick-unis-lm-ar1-1-dat-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>If we looked at an ACF of the residuals of a linear regression, we’d see that the residuals are highly autocorrelated:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="linear-regression-with-ar1-errors.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">residuals</span>(<span class="fu">lm</span>(yt <span class="sc">~</span> dt)))</span></code></pre></div>
<p><img src="MARSS_Manual_files/figure-html/quick-unis-lm-ar1-acf-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>We can fit this model (Equation <a href="linear-regression-with-ar1-errors.html#eq:short-lr-ar1">(6.7)</a>) with <code>MARSS()</code>. Please note that there are many better R packages specifically designed for linear regression models with correlated errors. This simple example is to help you understand model specification with the <strong>MARSS</strong> package.</p>
<p>To fit this model, we need match our Equation <a href="linear-regression-with-ar1-errors.html#eq:short-lr-ar1">(6.7)</a> with the full MARSS model written in matrix form (Equation <a href="#eq:marss-part2">(5.2)</a>). Here it is with the parameters that are zero dropped. <span class="math inline">\(\mathbf{Z}_t\)</span> is identity and is also dropped. The <span class="math inline">\(\mathbf{B}\)</span> and <span class="math inline">\(\mathbf{D}\)</span> are time-constant so the <span class="math inline">\(t\)</span> subscript is dropped. The <span class="math inline">\(\mathbf{x}_t\)</span> are the AR(1) errors and the <span class="math inline">\(\mathbf{y}_t\)</span> is the linear regression with <span class="math inline">\(\mathbf{D}\)</span> being the effect sizes and the <span class="math inline">\(\mathbf{d}\)</span> being the covariate.</p>
<p><span class="math display" id="eq:short-lr-ar\tag{6.8}on}(#eq:short-lr-ar1-marss2)
\begin{gathered}
\mathbf{x}_t = \mathbf{B}\mathbf{x}_{t-1} + \mathbf{w}_t, \text{ where } \mathbf{w}_t \sim \,\text{MVN}(0,\mathbf{Q}_t)\\
\mathbf{y}_t = \mathbf{x}_t + \mathbf{D}\mathbf{d}_t
\end{gathered}
\end{equation}\]</span></p>
<p>Here is what the model looks like if we write the parameters explicitly in matrix form. The matrices are <span class="math inline">\(1 \times 1\)</span>.
<span class="math display" id="eq:short-lr-ar1-mat">\[\begin{equation}
\begin{gathered}
\begin{bmatrix}x\end{bmatrix}_{t} = \begin{bmatrix}b\end{bmatrix}\begin{bmatrix}x\end{bmatrix}_{t-1} + \begin{bmatrix}0\end{bmatrix} + \begin{bmatrix}w\end{bmatrix}_{t}  \\
\begin{bmatrix}y\end{bmatrix}_{t} = \begin{bmatrix}x\end{bmatrix}_{t} + \begin{bmatrix}\beta\end{bmatrix}\begin{bmatrix}d\end{bmatrix}_t
\end{gathered}
\tag{6.9}
\end{equation}\]</span></p>
<p>To create the model list for <code>MARSS()</code>, we specify the parameter matrices one-to-one like they look in Equation @ref(eq:short.lr.ar1.mat).</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="linear-regression-with-ar1-errors.html#cb82-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">&quot;r&quot;</span>)  <span class="co"># no v_t</span></span>
<span id="cb82-2"><a href="linear-regression-with-ar1-errors.html#cb82-2" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">&quot;beta&quot;</span>)</span>
<span id="cb82-3"><a href="linear-regression-with-ar1-errors.html#cb82-3" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>)  <span class="co"># since arima.sim was used, no u</span></span>
<span id="cb82-4"><a href="linear-regression-with-ar1-errors.html#cb82-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">&quot;b&quot;</span>)</span>
<span id="cb82-5"><a href="linear-regression-with-ar1-errors.html#cb82-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">matrix</span>(dt, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb82-6"><a href="linear-regression-with-ar1-errors.html#cb82-6" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>)</span></code></pre></div>
<p><code>MARSS()</code> requires <span class="math inline">\(\mathbf{d}\)</span> be a matrix also. Each row is a covariate and each column is a time step. No missing values allowed as this is an input.</p>
<p>How should we treat the <span class="math inline">\(\mathbf{R}\)</span> matrix? It is zero, and we could set <span class="math inline">\(\mathbf{R}\)</span> to zero:</p>
<pre><code>R &lt;- matrix(0)</code></pre>
<p>However, the EM algorithm in the <strong>MARSS</strong> package will not perform well at all with <span class="math inline">\(\mathbf{R}\)</span> set to zero and it has to do with how <span class="math inline">\(\mathbf{R}=0\)</span> affects the update equations. You can use the BFGS algorithm or estimate <span class="math inline">\(\mathbf{R}\)</span>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="linear-regression-with-ar1-errors.html#cb84-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="st">&quot;r&quot;</span>)</span>
<span id="cb84-2"><a href="linear-regression-with-ar1-errors.html#cb84-2" aria-hidden="true" tabindex="-1"></a>mod.list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> B, <span class="at">U =</span> U, <span class="at">R =</span> R, <span class="at">D =</span> D, <span class="at">d =</span> d, <span class="at">A =</span> A)</span>
<span id="cb84-3"><a href="linear-regression-with-ar1-errors.html#cb84-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(yt, <span class="at">model =</span> mod.list)</span></code></pre></div>
<pre><code>Success! abstol and log-log tests passed at 75 iterations.
Alert: conv.test.slope.tol is 0.5.
Test with smaller values (&lt;0.1) to ensure convergence.

MARSS fit is
Estimation method: kem 
Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001
Estimation converged in 75 iterations. 
Log-likelihood: -31.93036 
AIC: 73.86072   AICc: 74.49902   
 
       Estimate
R.r      0.0116
B.b      0.9150
Q.Q      0.0911
x0.x0    0.0916
D.beta   1.0817
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
<p>Or use the BFGS algorithm for fitting:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="linear-regression-with-ar1-errors.html#cb86-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>)</span>
<span id="cb86-2"><a href="linear-regression-with-ar1-errors.html#cb86-2" aria-hidden="true" tabindex="-1"></a>mod.list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">B =</span> B, <span class="at">U =</span> U, <span class="at">R =</span> R, <span class="at">D =</span> D, <span class="at">d =</span> d, <span class="at">A =</span> A)</span>
<span id="cb86-3"><a href="linear-regression-with-ar1-errors.html#cb86-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">MARSS</span>(yt, <span class="at">model =</span> mod.list, <span class="at">method =</span> <span class="st">&quot;BFGS&quot;</span>)</span></code></pre></div>
<pre><code>Success! Converged in 169 iterations.
Function MARSSkfas used for likelihood calculation.

MARSS fit is
Estimation method: BFGS 
Estimation converged in 169 iterations. 
Log-likelihood: -32.16264 
AIC: 72.32527   AICc: 72.74632   
 
       Estimate
B.b      0.8970
Q.Q      0.1114
x0.x0    0.0936
D.beta   1.0858
Initial states (x0) defined at t=0

Standard errors have not been calculated. 
Use MARSSparamCIs to compute CIs and bias estimates.</code></pre>
<p>This is the same model you are fitting when you pass in <code>xreg</code> with the <code>arima()</code> function:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="linear-regression-with-ar1-errors.html#cb88-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">arima</span>(yt, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">xreg =</span> dt, <span class="at">include.mean =</span> <span class="cn">FALSE</span>, </span>
<span id="cb88-2"><a href="linear-regression-with-ar1-errors.html#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span></code></pre></div>
<pre><code>
Call:
stats::arima(x = yt, order = c(1, 0, 0), xreg = dt, include.mean = FALSE, method = &quot;ML&quot;)

Coefficients:
         ar1      dt
      0.8887  1.0859
s.e.  0.0428  0.0251

sigma^2 estimated as 0.1115:  log likelihood = -32.97,  aic = 71.93</code></pre>
<p>Again the estimates are slightly different due to different treatment of the initial conditons.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linear-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression-with-ar1-errors-and-independent-errors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nwfsc-timeseries/MARSS-Manual/blob/master/cleanedRmd/03-1-uniss.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MARSS_Manual.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
